<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Our 2nd Anniversary Love Story ‚ù§Ô∏è</title>
    <link href="https://fonts.googleapis.com/css2?family=Pacifico&display=swap" rel="stylesheet">
    <style>
        /* Modern Romantic Palette with Cute Accents */
        :root {
            --bg-color: #f1e5e5; /* Soft Cream/Off-White */
            --text-color: #333333; /* Deep Charcoal */
            --accent-color: #D67A73; /* Muted Rose/Coral for warmth */
            --light-accent-color: #FFC0CB; /* Light Pink for cute details */
            --border-color: #E0DEDD; /* Light Gray for borders */
            --font-primary: 'Georgia', serif;
            --font-cute: 'Pacifico', cursive; /* Handwritten style */
            --font-heading: 'Helvetica Neue', sans-serif;
        }

        /* Base Styles & Modern Reset */
        body {
            background-color: var(--bg-color);
            font-family: var(--font-primary);
            color: var(--text-color);
            margin: 0;
            line-height: 1.6;
            display: flex;
            justify-content: center;
            padding: 40px 20px;
            box-sizing: border-box;
            min-height: 100vh;
        }

        .site-wrapper {
            max-width: 1200px;
            width: 100%;
            text-align: center;
        }

        /* Hero Section - Clean Typography */
        .hero-section {
            padding: 60px 0 40px;
            border-bottom: 1px solid var(--border-color);
            position: relative;
        }

        .title {
            font-size: 3.5em;
            font-weight: 700;
            color: var(--text-color);
            margin-bottom: 0.1em;
            font-family: var(--font-heading);
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 15px;
        }

        .title .heart-icon {
            color: var(--accent-color);
            font-size: 0.8em;
            animation: pulse 1.5s infinite alternate;
        }

        .subtitle {
            font-size: 1.8em;
            font-family: var(--font-cute);
            color: var(--accent-color);
            letter-spacing: 0.05em;
            margin-top: 5px;
        }

        /* Initial Content Section */
        .content-section {
            padding: 40px 0;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 40px;
        }

        .message-box {
            background-color: white;
            padding: 40px;
            border-radius: 12px;
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.08);
            text-align: left;
            width: 100%;
            max-width: 550px;
            border-left: 6px solid var(--accent-color);
            position: relative;
        }

        .message-box::before {
            content: 'üíñ';
            position: absolute;
            top: 15px;
            right: 15px;
            font-size: 1.8em;
            color: var(--light-accent-color);
            animation: float 3s infinite ease-in-out;
        }

        .date {
            margin-top: 25px;
            font-size: 1em;
            color: var(--accent-color);
            font-weight: bold;
            text-align: right;
            border-top: 1px dashed var(--light-accent-color);
            padding-top: 12px;
            font-family: var(--font-cute);
        }

        .anniversary-photo {
            max-width: 100%;
            height: auto;
            border-radius: 12px;
            object-fit: cover;
            aspect-ratio: 16/9;
            box-shadow: 0 15px 40px rgba(0, 0, 0, 0.15);
            transition: transform 0.4s ease-out, box-shadow 0.4s ease-out;
        }

        .anniversary-photo:hover {
            transform: scale(1.03) rotate(1deg);
            box-shadow: 0 20px 50px rgba(0, 0, 0, 0.2);
        }
        
        /* --- IMMERSIVE GALLERY SECTION STYLES (Carousel) --- */

        #immersive-gallery-section {
            margin-top: 80px;
            background-color: white;
            padding: 50px;
            border-radius: 15px;
            box-shadow: 0 0 25px rgba(0, 0, 0, 0.05);
            display: flex;
            gap: 50px;
            text-align: left;
            position: relative;
            overflow: hidden;
        }
        
        #immersive-gallery-section::before, #immersive-gallery-section::after {
            content: '‚ù§Ô∏è';
            position: absolute;
            color: var(--light-accent-color);
            font-size: 2em;
            opacity: 0.6;
            animation: float 4s infinite ease-in-out;
            z-index: 1;
        }
        #immersive-gallery-section::before {
            top: 10%;
            left: -3%;
            animation-delay: 1s;
            transform: rotate(-15deg);
        }
        #immersive-gallery-section::after {
            bottom: 5%;
            right: -5%;
            animation-delay: 2.5s;
            transform: rotate(20deg);
        }

        /* Responsive Columns for Desktop */
        @media (min-width: 900px) {
            #immersive-gallery-section {
                flex-direction: row;
                text-align: justify;
            }
            .message-column {
                flex: 3;
                max-height: none; 
                overflow-y: visible; 
                padding-right: 25px; 
                scroll-behavior: smooth;
            }
            .gallery-column {
                flex: 2;
                min-height: 450px; /* Minimum height on desktop */
                aspect-ratio: 4/3; /* Maintain a nice viewing ratio */
            }
        }
        
        /* Stacked Columns for Mobile */
        @media (max-width: 899px) {
            #immersive-gallery-section {
                flex-direction: column;
            }
            .message-column {
                max-height: none; 
                overflow-y: visible;
                padding-right: 0;
            }
            .gallery-column {
                width: 100%;
                aspect-ratio: 16/9; /* Wider aspect ratio on mobile */
                min-height: 300px; /* Ensure minimum height */
            }
        }

        .message-column h2 {
            font-family: var(--font-cute);
            color: var(--accent-color);
            font-size: 2.2em;
            border-bottom: 2px solid var(--light-accent-color);
            padding-bottom: 12px;
            margin-top: 0;
            margin-bottom: 25px;
            text-align: center;
        }

        .message-column p {
            margin-bottom: 1.2em;
        }

        .gallery-column {
            position: sticky;
            top: 40px; 
            overflow: hidden;
            border-radius: 12px;
            box-shadow: 0 6px 15px rgba(0, 0, 0, 0.15);
            background-color: var(--bg-color);
        }
        
        /* Improved carousel track that scales with content */
        .carousel-track {
            display: flex;
            width: 500%; /* 100% * number of items */
            height: 100%;
            transition: transform 0.8s ease-in-out;
        }

        .carousel-item {
            position: relative; /* Changed from absolute */
            width: 100%;
            height: 100%;
            flex: 1;
            background-color: #ccc;
            overflow: hidden;
        }

        /* Images fill their container while maintaining aspect ratio */
        .carousel-item img {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            object-fit: cover;
            object-position: center;
            transition: transform 0.3s ease;
        }
        
        /* Optional: subtle zoom on hover */
        .carousel-item:hover img {
            transform: scale(1.03);
        }
        
        /* --- NEW MEMORY LINE GALLERY STYLES (Dynamic Grid) --- */
        #memory-line-gallery {
            margin-top: 100px;
            padding: 60px 20px;
            background-color: var(--light-accent-color);
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            position: relative;
            overflow: hidden;
        }

        #memory-line-gallery h2 {
            font-family: var(--font-cute);
            font-size: 2.8em;
            color: white;
            margin-bottom: 40px;
            position: relative;
            z-index: 2;
            text-shadow: 1px 1px 3px rgba(0,0,0,0.1);
        }

        .memory-grid {
            display: grid;
            /* Responsive columns: at least 180px wide */
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); 
            /* Key for dynamic sizing: set a tiny auto-row height */
            grid-auto-rows: 5px; 
            gap: 15px;
            max-width: 1000px;
            margin: 0 auto;
        }

        .memory-item {
            overflow: hidden;
            border-radius: 8px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
            position: relative;
            cursor: pointer;
            transition: transform 0.3s ease-out, box-shadow 0.3s ease-out;
            background-color: #f0f0f0;
            
            /* The following property is set by JS based on image aspect ratio */
            /* grid-row-end: span X; */
        }

        .memory-item img {
            width: 100%;
            height: auto; /* Allow height to adjust naturally based on width */
            display: block;
        }
        
        .memory-item:hover {
            transform: scale(1.03) rotate(-1deg);
            box-shadow: 0 8px 20px rgba(0,0,0,0.2);
            z-index: 5;
        }
        
        /* --- Subtle Animations --- */

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }

        @keyframes float {
            0% { transform: translateY(0px) rotate(0deg); }
            50% { transform: translateY(-8px) rotate(5deg); }
            100% { transform: translateY(0px) rotate(0deg); }
        }

        /* Applying the animations */
        .fade-in {
            animation: fadeIn 1.5s ease-out forwards;
        }

        .slide-up {
            animation: slideUp 1.5s ease-out 0.5s forwards;
            opacity: 0;
        }

        /* Hide scrollbar for aesthetic, while still allowing scrolling */
        .message-column::-webkit-scrollbar {
            width: 5px;
        }
        .message-column::-webkit-scrollbar-thumb {
            background-color: var(--border-color);
            border-radius: 10px;
        }
        .message-column::-webkit-scrollbar-track {
            background: transparent;
        }
    </style>
</head>
<body>
    <div class="site-wrapper">
        <header class="hero-section">
            <h1 class="title fade-in">
                <span class="heart-icon">‚ù§Ô∏è</span> 
                Our Story, Chapter Two.
                <span class="heart-icon">‚ù§Ô∏è</span>
            </h1>
            <p class="subtitle fade-in" style="animation-delay: 0.5s; opacity: 0;">Happy 2nd Anniversary, my love! üíñ</p>
        </header>

        <section class="content-section">
            <div class="message-box fade-in" style="animation-delay: 1s; opacity: 0;">
                <p>Every day with you is a gift, a promise, and a joy. Let's celebrate to many more years of love, growth, and adventures!</p>
                <p class="date">October 27, 2025</p>
            </div>
            
            <img src="/images/header.jpg" alt="A beautiful photo of the couple" class="anniversary-photo slide-up">
        </section>

        <!-- IMMERSIVE GALLERY SECTION (CAROUSEL AND MESSAGE) -->
        <section id="immersive-gallery-section" class="fade-in" style="animation-delay: 1.5s; opacity: 0;">
            
            <div class="message-column">
                <h2>A Message to my love of my life <span class="heart-icon" style="font-size: 0.8em; animation-delay: 0.5s;">üíï</span></h2>

                <p>My Love, Baby, Mimiww, and joyciepie, two years ago today (ambilis huhu), we started a journey doubting whether this would work or not but as time passes by we realized we just need more time to prepare and love each other more. It's easy to mark dates on a calendar, but it's the moments in between that truly matter.</p>

                <p>This whole page is dedicated to celebrating our beautiful complexity of our relationship. You are my best friend, my greatest lover, and the source of my happiness. I cherish the quiet mornings, the late-night talks, the silly inside jokes, and the unwavering support we offer each other. I look at where we started, two people learning each other's quirks and dreams and I'm amazed at the journey we've built.</p>

                <p>Do you remember the we go to Arroceros? The moment we first got there together? That feeling of strong happiness is a bookmark in our story atleast to me, and every time I look at the pictures (like the one currently next to this message!), I'm instantly taken back to that day. miss ko na mimiw</p>

                <p>I know life isn't always in our control. We've faced Arguments, Fights but we've come out stronger because of it we grew to know each others preference and know what to do and what not to do. Thank you for your patience, your empathy, and your willingness to always choose understanding over conflict. That is the true strength of our relationship na kahit magbangayan pa and such we still learn to think and understand each sides.</p>

                <p>As we step into our 2nd year anniversary, my promise to you remains the same: I will continue to be your biggest cheerer, your quiet comfort, and the person who reminds you how incredible you are, every single day. I can't wait to see what adventures, goals, and happy memories the next year will bring. I love you so much that it‚Äôs more than words can say.</p>

                <p>Yours always and forever,</p>
                <p style="font-style: italic; color: var(--accent-color); font-weight: bold; font-family: var(--font-cute);">Reychii</p>
            </div>

            <div class="gallery-column">
                <div class="carousel-track" id="image-carousel">
                    <!-- Updated placeholder aspect ratio for better fit and visual demo -->
                    <div class="carousel-item"><img src="images/HH1.jpg" onerror="this.src='https://placehold.co/600x400/FFC0CB/333333?text=Carousel+Pic+1';" alt="Couple holding hands in a field"></div>
                    <div class="carousel-item"><img src="images/HH2.jpg" onerror="this.src='https://placehold.co/600x400/D67A73/FFFFFF?text=Carousel+Pic+2';" alt="Couple on a cute coffee date"></div>
                    <div class="carousel-item"><img src="images/HH3.jpg" onerror="this.src='https://placehold.co/600x400/f1e5e5/D67A73?text=Carousel+Pic+3';" alt="Couple walking by the sea"></div>
                    <div class="carousel-item"><img src="images/HH4.jpg" onerror="this.src='https://placehold.co/600x400/FFC0CB/333333?text=Carousel+Pic+4';" alt="Another moment"></div>
                    <div class="carousel-item"><img src="images/HH5.jpg" onerror="this.src='https://placehold.co/600x400/FFC0CB/333333?text=Carousel+Pic+5';" alt="Another moment"></div>
                </div>
            </div>

        </section>

        <!-- NEW DYNAMIC MEMORY LINE GALLERY -->
        <section id="memory-line-gallery" class="fade-in" style="animation-delay: 2s; opacity: 0;">
            <h2>A Memory Timeline of Our Love <span class="heart-icon" style="font-size: 0.8em;">‚ú®</span></h2>
            <div class="memory-grid">
                <div class="memory-item"><img src="/images/1.jpg" alt="Vertical memory photo" onerror="resizeGridItem(this.parentElement)"></div>
                <div class="memory-item"><img src="/images/2.JPG" alt="Horizontal memory photo" onerror="resizeGridItem(this.parentElement)"></div>
                <div class="memory-item"><img src="/images/3.jpg" alt="Square memory photo" onerror="resizeGridItem(this.parentElement)"></div>
                <div class="memory-item"><img src="/images/4.jpeg" alt="Horizontal memory photo" onerror="resizeGridItem(this.parentElement)"></div>
                <div class="memory-item"><img src="/images/5.JPG" alt="Tall vertical photo" onerror="resizeGridItem(this.parentElement)"></div>
                <div class="memory-item"><img src="/images/6.JPG" alt="Small square photo" onerror="resizeGridItem(this.parentElement)"></div>
                <div class="memory-item"><img src="/images/7.JPG" alt="Wide memory photo" onerror="resizeGridItem(this.parentElement)"></div>
                <div class="memory-item"><img src="/images/8.jpg" alt="Vertical memory photo" onerror="resizeGridItem(this.parentElement)"></div>
                <div class="memory-item"><img src="/images/9.jpg" alt="Wide memory photo" onerror="resizeGridItem(this.parentElement)"></div>
                <div class="memory-item"><img src="/images/10.jpg" alt="Vertical memory photo" onerror="resizeGridItem(this.parentElement)"></div>
                <div class="memory-item"><img src="/images/11.jpg" alt="Vertical memory photo" onerror="resizeGridItem(this.parentElement)"></div>
                <div class="memory-item"><img src="/images/12.JPG" alt="Vertical memory photo" onerror="resizeGridItem(this.parentElement)"></div>
                <div class="memory-item"><img src="/images/13.jpg" alt="Vertical memory photo" onerror="resizeGridItem(this.parentElement)"></div>
                <div class="memory-item"><img src="/images/14.jpg" alt="Vertical memory photo" onerror="resizeGridItem(this.parentElement)"></div>
                <div class="memory-item"><img src="/images/15.jpg" alt="Vertical memory photo" onerror="resizeGridItem(this.parentElement)"></div>
                <div class="memory-item"><img src="/images/16.JPG" alt="Vertical memory photo" onerror="resizeGridItem(this.parentElement)"></div>
                <div class="memory-item"><img src="/images/17.jpg" alt="Vertical memory photo" onerror="resizeGridItem(this.parentElement)"></div>
                <div class="memory-item"><img src="/images/18.JPG" alt="Vertical memory photo" onerror="resizeGridItem(this.parentElement)"></div>
                <div class="memory-item"><img src="/images/19.jpg" alt="Vertical memory photo" onerror="resizeGridItem(this.parentElement)"></div>
                <div class="memory-item"><img src="/images/20.JPG" alt="Vertical memory photo" onerror="resizeGridItem(this.parentElement)"></div>
                <div class="memory-item"><img src="/images/21.jpg" alt="Vertical memory photo" onerror="resizeGridItem(this.parentElement)"></div>
                <div class="memory-item"><img src="/images/22.jpg" alt="Vertical memory photo" onerror="resizeGridItem(this.parentElement)"></div>
                <div class="memory-item"><img src="/images/23.jpg" alt="Vertical memory photo" onerror="resizeGridItem(this.parentElement)"></div>
                <div class="memory-item"><img src="/images/24.jpg" alt="Vertical memory photo" onerror="resizeGridItem(this.parentElement)"></div>
                <div class="memory-item"><img src="/images/25.jpg" alt="Vertical memory photo" onerror="resizeGridItem(this.parentElement)"></div>
                <div class="memory-item"><img src="/images/26.jpg" alt="Vertical memory photo" onerror="resizeGridItem(this.parentElement)"></div>
                <div class="memory-item"><img src="/images/27.jpg" alt="Vertical memory photo" onerror="resizeGridItem(this.parentElement)"></div>
                <div class="memory-item"><img src="/images/28.jpg" alt="Vertical memory photo" onerror="resizeGridItem(this.parentElement)"></div>
                <div class="memory-item"><img src="/images/29.jpg" alt="Vertical memory photo" onerror="resizeGridItem(this.parentElement)"></div>
                <div class="memory-item"><img src="/images/30.jpg" alt="Vertical memory photo" onerror="resizeGridItem(this.parentElement)"></div>
                <div class="memory-item"><img src="/images/31.jpg" alt="Vertical memory photo" onerror="resizeGridItem(this.parentElement)"></div>
                <div class="memory-item"><img src="/images/32.jpg" alt="Vertical memory photo" onerror="resizeGridItem(this.parentElement)"></div>
                <div class="memory-item"><img src="/images/33.jpg" alt="Vertical memory photo" onerror="resizeGridItem(this.parentElement)"></div>
                <div class="memory-item"><img src="/images/34.jpg" alt="Vertical memory photo" onerror="resizeGridItem(this.parentElement)"></div>
                <div class="memory-item"><img src="/images/35.jpeg" alt="Vertical memory photo" onerror="resizeGridItem(this.parentElement)"></div>
                <div class="memory-item"><img src="/images/36.jpg" alt="Vertical memory photo" onerror="resizeGridItem(this.parentElement)"></div>
                <div class="memory-item"><img src="/images/37.jpg" alt="Vertical memory photo" onerror="resizeGridItem(this.parentElement)"></div>
                <div class="memory-item"><img src="/images/38.jpg" alt="Vertical memory photo" onerror="resizeGridItem(this.parentElement)"></div>
                <div class="memory-item"><img src="/images/39.jpg" alt="Vertical memory photo" onerror="resizeGridItem(this.parentElement)"></div>
                <div class="memory-item"><img src="/images/40.jpg" alt="Vertical memory photo" onerror="resizeGridItem(this.parentElement)"></div>
                <div class="memory-item"><img src="/images/41.jpg" alt="Vertical memory photo" onerror="resizeGridItem(this.parentElement)"></div>
                <div class="memory-item"><img src="/images/42.jpg" alt="Vertical memory photo" onerror="resizeGridItem(this.parentElement)"></div>
                <div class="memory-item"><img src="/images/43.jpg" alt="Vertical memory photo" onerror="resizeGridItem(this.parentElement)"></div>
                <div class="memory-item"><img src="/images/44.jpg" alt="Vertical memory photo" onerror="resizeGridItem(this.parentElement)"></div>
                <div class="memory-item"><img src="/images/45.jpg" alt="Vertical memory photo" onerror="resizeGridItem(this.parentElement)"></div>
                <div class="memory-item"><img src="/images/46.jpg" alt="Vertical memory photo" onerror="resizeGridItem(this.parentElement)"></div>
                <div class="memory-item"><img src="/images/47.jpeg" alt="Vertical memory photo" onerror="resizeGridItem(this.parentElement)"></div>
                <div class="memory-item"><img src="/images/48.jpeg" alt="Vertical memory photo" onerror="resizeGridItem(this.parentElement)"></div>
                <div class="memory-item"><img src="/images/49.png" alt="Vertical memory photo" onerror="resizeGridItem(this.parentElement)"></div>
                <div class="memory-item"><img src="/images/50.jpeg" alt="Vertical memory photo" onerror="resizeGridItem(this.parentElement)"></div>
                <div class="memory-item"><img src="/images/51.jpeg" alt="Vertical memory photo" onerror="resizeGridItem(this.parentElement)"></div>
                <div class="memory-item"><img src="/images/52.jpeg" alt="Vertical memory photo" onerror="resizeGridItem(this.parentElement)"></div>
                <div class="memory-item"><img src="/images/53.jpeg" alt="Vertical memory photo" onerror="resizeGridItem(this.parentElement)"></div>
                <div class="memory-item"><img src="/images/54.jpeg" alt="Vertical memory photo" onerror="resizeGridItem(this.parentElement)"></div>
                <div class="memory-item"><img src="/images/55.jpeg" alt="Vertical memory photo" onerror="resizeGridItem(this.parentElement)"></div>
                <div class="memory-item"><img src="/images/56.jpeg" alt="Vertical memory photo" onerror="resizeGridItem(this.parentElement)"></div>
                <div class="memory-item"><img src="/images/57.jpeg" alt="Vertical memory photo" onerror="resizeGridItem(this.parentElement)"></div>
                <div class="memory-item"><img src="/images/58.jpeg" alt="Vertical memory photo" onerror="resizeGridItem(this.parentElement)"></div>
                <div class="memory-item"><img src="/images/59.jpeg" alt="Vertical memory photo" onerror="resizeGridItem(this.parentElement)"></div>
                <div class="memory-item"><img src="/images/60.JPG" alt="Vertical memory photo" onerror="resizeGridItem(this.parentElement)"></div>
            </div>
        </section>

        <p style="font-style: italic; color: var(--accent-color); font-weight: bold; font-family: var(--font-cute);">10 / 27 / 25</p>
    </div>
    
    <script>
        // --- 1. CAROUSEL LOGIC ---
        const carousel = document.getElementById('image-carousel');
        const items = document.querySelectorAll('#image-carousel .carousel-item');
        let currentIndex = 0;

        function updateCarousel() {
            // Calculate offset based on the item width (20% since we have 5 items)
            const offset = -(currentIndex * 20);
            carousel.style.transform = `translateX(${offset}%)`;
        }

        function nextSlide() {
            currentIndex = (currentIndex + 1) % items.length;
            updateCarousel();
        }

        function prevSlide() {
            currentIndex = (currentIndex - 1 + items.length) % items.length;
            updateCarousel();
        }

        // Optional: Add keyboard navigation
        document.addEventListener('keydown', (e) => {
            if (e.key === 'ArrowLeft') prevSlide();
            if (e.key === 'ArrowRight') nextSlide();
        });

        // Auto-advance the carousel every 4 seconds
        let autoplayTimer = setInterval(nextSlide, 4000);

        // Optional: Pause autoplay on hover
        carousel.addEventListener('mouseenter', () => clearInterval(autoplayTimer));
        carousel.addEventListener('mouseleave', () => autoplayTimer = setInterval(nextSlide, 4000));

        // Initialize the first slide
        updateCarousel();
        
        
        // --- 2. DYNAMIC MEMORY LINE GRID LOGIC ---

        /**
         * Calculates and sets the row span for a grid item based on its image's aspect ratio.
         * This creates the dynamic collage effect.
         * @param {HTMLElement} item - The parent .memory-item div.
         */
        function resizeGridItem(item) {
            const grid = document.querySelector('.memory-grid');
            if (!grid) return;

            // Get the calculated row height and gap from CSS for accurate spanning
            const rowHeight = parseInt(window.getComputedStyle(grid).getPropertyValue('grid-auto-rows'));
            const rowGap = parseInt(window.getComputedStyle(grid).getPropertyValue('gap'));

            const img = item.querySelector('img');
            
            // Check if image is fully loaded to access natural dimensions
            if (!img || !img.complete || img.naturalWidth === 0) {
                // If not loaded, attach event listener to re-run on load
                img.onload = () => resizeGridItem(item);
                // Attach to onerror too, for placeholder image calculation
                img.onerror = () => resizeGridItem(item); 
                return;
            }

            // 1. Determine the actual height the image should take at 100% width
            const itemWidth = item.clientWidth;
            // Fallback for division by zero (if naturalWidth is still zero unexpectedly)
            const aspectRatio = img.naturalWidth > 0 ? img.naturalHeight / img.naturalWidth : 1;
            const contentHeight = aspectRatio * itemWidth;

            // 2. Calculate the required row span (content height + gaps)
            // Use Math.round for a cleaner look, ensuring span is at least 1
            let rowSpan = Math.round((contentHeight + rowGap) / (rowHeight + rowGap));
            rowSpan = Math.max(1, rowSpan); // Ensure minimum span of 1

            // 3. Apply the span to the parent grid item
            item.style.gridRowEnd = `span ${rowSpan}`;
        }

        function resizeAllGridItems() {
            const allItems = document.querySelectorAll('.memory-item');
            allItems.forEach(resizeGridItem);
        }

        // --- 3. INITIALIZATION & EVENT LISTENERS ---

        document.addEventListener('DOMContentLoaded', () => {
            // Initial animation setup
            document.querySelectorAll('.fade-in').forEach(element => {
                const delay = parseFloat(element.style.animationDelay) || 0;
                // Use a standard transition instead of relying solely on the animation class for visibility
                element.style.transition = 'opacity 1.5s ease-out';
                setTimeout(() => {
                    element.style.opacity = 1; 
                }, delay * 1000);
            });
            
            // Run dynamic grid sizing once all resources are loaded
            window.addEventListener('load', resizeAllGridItems);
            
            // Re-run sizing when the browser window changes size
            let resizeTimer;
            window.addEventListener('resize', () => {
                clearTimeout(resizeTimer);
                resizeTimer = setTimeout(resizeAllGridItems, 150); // Debounce resize
            });

            // This line ensures the dynamic calculation runs for local/mock images immediately
            resizeAllGridItems();
        });
        
    </script>
</body>
</html>
